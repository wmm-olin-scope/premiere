// Generated by CoffeeScript 1.6.3
var contentDiv, countdownStart, getCookie, movieDone, movieStart, setupCategory, startCountdown, startCountdownCheck, startMovie, startPostshow, switchContent, userCategory;

contentDiv = $("#content");

movieStart = Date.now() + 25 * 1000;

countdownStart = movieStart - 10 * 1000;

movieDone = movieStart + 10 * 1000;

userCategory = "General";

switchContent = function(contentUrl, done) {
  contentDiv.html("");
  return $.ajax(contentUrl).fail(function(err) {
    return console.log(err);
  }).done(function(content) {
    contentDiv.html(content);
    if (done) {
      return done();
    }
  });
};

getCookie = function(name) {
  var re, result;
  re = new RegExp("(?:^" + name + "|;\s*" + name + ")=(.*?)(?:;|$)", "g");
  result = re.exec(document.cookie);
  if (result) {
    return result[1];
  } else {
    return null;
  }
};

setupCategory = function() {
  var category, onClickCategory;
  onClickCategory = function(category) {
    userCategory = category;
    return switchContent("/premiere/preshow/" + category);
  };
  category = getCookie("userCategory");
  if (category !== null) {
    return onClickCategory(category);
  } else {
    return switchContent("/premiere/category", function() {
      var _i, _len, _ref, _results;
      _ref = ["General", "Student", "Parent", "Educator"];
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        category = _ref[_i];
        _results.push((function(category) {
          return $("button#" + category).on("click", function() {
            return onClickCategory(category);
          });
        })(category));
      }
      return _results;
    });
  }
};

startCountdown = function() {
  switchContent("/premiere/countdown");
  return setTimeout(startMovie, movieStart - Date.now());
};

startCountdownCheck = function() {
  console.log(countdownStart - Date.now());
  return setTimeout(startCountdown, countdownStart - Date.now());
};

startMovie = function() {
  switchContent("/premiere/movie");
  return setTimeout(startPostshow, movieDone - Date.now());
};

startPostshow = function() {
  return switchContent("/premiere/postshow/" + userCategory);
};

if (Date.now() > movieDone) {
  startPostshow();
} else if (Date.now() > movieStart) {
  startMovie();
} else if (Date.now() > countdownStart) {
  console.log("THe fuck!");
  console.log(countdownStart);
  console.log(+Date.now());
  startCountdown();
} else {
  setupCategory();
  startCountdownCheck();
}
