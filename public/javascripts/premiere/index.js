// Generated by CoffeeScript 1.6.3
var contentDiv, getCookie, movieDone, movieStart, setupCategory, startCountdown, startMovie, startMovieCheck, startPostshow, switchContent, transition, userCategory;

contentDiv = $("#content");

movieStart = Date.now() + 25 * 1000;

movieDone = movieStart + 10 * 1000;

userCategory = "General";

switchContent = function(contentUrl, done) {
  if (done == null) {
    done = null;
  }
  return $.ajax(contentUrl).fail(function(err) {
    return console.log(err);
  }).done(function(content) {
    contentDiv.html(content);
    if (done) {
      return done();
    }
  });
};

transition = function(request, title, duration) {
  var progressBar, progressWindow;
  if (title == null) {
    title = null;
  }
  if (duration == null) {
    duration = 750;
  }
  progressWindow = $("#progress-window");
  $("body").append("<div id=\"progress-window\">\n    <div id=\"progress-bar\"></div>\n</div>");
  progressBar = $("#progress-bar", progressWindow);
  progressWindow.dialog({
    dialogClass: "no-close",
    width: 600,
    height: 105,
    modal: true,
    resizable: false,
    draggable: false
  });
  if (title) {
    progressWindow.dialog("option", "title", title);
  } else {
    $(".ui-dialog-titlebar", progressWindow.parent()).css("display", "none");
  }
  progressWindow.dialog("open");
  progressBar.progressbar({
    value: false
  });
  return request.always(function() {
    progressBar.progressbar({
      value: 1
    });
    return $(".ui-progressbar-value", progressBar).animate({
      width: "100%"
    }, {
      duration: duration,
      complete: function() {
        progressWindow.dialog("close");
        return progressWindow.parent().remove();
      }
    });
  });
};

getCookie = function(name) {
  var re, result;
  re = new RegExp("(?:^" + name + "|;\s*" + name + ")=(.*?)(?:;|$)", "g");
  result = re.exec(document.cookie);
  if (result) {
    return result[1];
  } else {
    return null;
  }
};

setupCategory = function() {
  var category, onClickCategory, req;
  onClickCategory = function(category) {
    userCategory = category;
    return transition(switchContent("/premiere/preshow/" + category));
  };
  category = null;
  if (category !== null) {
    return onClickCategory(category);
  } else {
    req = switchContent("/premiere/category", function() {
      var _i, _len, _ref, _results;
      _ref = ["General", "Student", "Parent", "Educator"];
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        category = _ref[_i];
        _results.push((function(category) {
          return $("button#" + category).on("click", function() {
            return onClickCategory(category);
          });
        })(category));
      }
      return _results;
    });
    return transition(req);
  }
};

startCountdown = function() {
  transition(switchContent("/premiere/countdown"));
  return setTimeout(startMovie, movieStart - Date.now());
};

startMovieCheck = function() {
  return setTimeout(startMovie, movieStart - Date.now());
};

startMovie = function() {
  transition(switchContent("/premiere/movie"), "Starting Movie", 3000);
  return setTimeout(startPostshow, movieDone - Date.now());
};

startPostshow = function() {
  return transition(switchContent("/premiere/postshow/" + userCategory));
};

$(function() {
  if (Date.now() > movieDone) {
    return startPostshow();
  } else if (Date.now() > movieStart) {
    return startMovie();
  } else {
    setupCategory();
    return startMovieCheck();
  }
});
